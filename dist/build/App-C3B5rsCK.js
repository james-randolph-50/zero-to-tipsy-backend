import{dE as xe,j as e,dF as Z,a as E,dG as J,dH as A,dI as ye,l as V,f as p,T as h,aJ as de,aS as je,a5 as ce,H as q,ds as be,p as Re,bq as ue,y as K,x as X,X as Me,r as ae,dJ as ee,z as De,dK as we,dL as ve,P as U,aR as se,bK as Ae,bL as Se,dM as Be,B as ge,d6 as te,b as Te,dN as Ce,E as H,aU as Ie,cB as ne,h as Pe,bD as Ee,dO as Le,bx as $e,a8 as pe,u as ze,an as Oe,dP as ke,dQ as Ne,aI as Fe,s as We,aX as Ue,aY as He,bU as C,$ as Ge,a0 as I,dR as Ve,dS as Q,cR as Y,M as G,dT as _e,dU as Qe,U as Ye,V as ie}from"./strapi-BdHBmQbs.js";import{f as re}from"./index-5iLltuk8.js";import{u as Ze,a as qe,R as Je,g as Ke,b as Xe}from"./ReleasesPage-oYsdW4zz.js";import"./index-BRVyLNfZ.js";import"./schemas-CIsW4IeO.js";import"./index-Dg09w_cQ.js";const es=V(p)`
  width: 100%;
  max-width: 256px;

  & > * {
    border-bottom: 1px solid ${({theme:s})=>s.colors.neutral150};
  }

  & > *:last-child {
    border-bottom: none;
  }
`,ss=V(p)`
  svg {
    fill: currentColor;
  }
`,P=({children:s,icon:t,color:r})=>e.jsx(Z.Trigger,{children:e.jsx(q,{variant:"ghost",endIcon:e.jsx(be,{}),children:e.jsxs(ss,{color:r,gap:2,children:[t,e.jsx(h,{textColor:r,variant:"omega",fontWeight:"bold",children:s})]})})}),ts=({action:s,status:t,hasErrors:r,requiredStage:i,entryStage:u})=>{const{formatMessage:o}=E();return s==="publish"?r||i&&i.id!==u?.id?e.jsx(P,{icon:e.jsx(J,{}),color:"danger600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.not-ready",defaultMessage:"Not ready to publish"})}):t==="draft"?e.jsx(P,{icon:e.jsx(A,{}),color:"success600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})}):t==="modified"?e.jsx(P,{icon:e.jsx(ye,{}),color:"alternative600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.modified",defaultMessage:"Ready to publish changes"})}):e.jsx(P,{icon:e.jsx(A,{}),color:"success600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})}):t==="published"?e.jsx(P,{icon:e.jsx(A,{}),color:"success600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})}):e.jsx(P,{icon:e.jsx(A,{}),color:"success600",children:o({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})},as=({hasErrors:s,errors:t,kind:r,contentTypeUid:i,documentId:u,locale:o})=>{const{formatMessage:d}=E();return e.jsxs(p,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(p,{gap:2,width:"100%",children:[e.jsx(h,{fontWeight:"bold",children:d({id:"content-releases.pages.ReleaseDetails.entry-validation.fields",defaultMessage:"Fields"})}),s?e.jsx(J,{fill:"danger600"}):e.jsx(A,{fill:"success600"})]}),e.jsx(h,{width:"100%",textColor:"neutral600",children:s?d({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.error",defaultMessage:"{errors} errors on fields."},{errors:t?Object.keys(t).length:0}):d({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.success",defaultMessage:"All fields are filled correctly."})}),s&&e.jsx(de,{tag:ce,to:{pathname:`/content-manager/${r==="collectionType"?"collection-types":"single-types"}/${i}/${u}`,search:o?je.stringify({plugins:{i18n:{locale:o}}}):""},variant:"secondary",fullWidth:!0,state:{forceValidation:!0},children:d({id:"content-releases.pages.ReleaseDetails.entry-validation.fields.see-errors",defaultMessage:"See errors"})})]})},ns=({contentTypeHasReviewWorkflow:s,requiredStage:t,entryStage:r})=>s?t&&t.id!==r?.id?e.jsx(J,{fill:"danger600"}):e.jsx(A,{fill:"success600"}):e.jsx(A,{fill:"neutral200"}),is=({contentTypeHasReviewWorkflow:s,requiredStage:t,entryStage:r,formatMessage:i})=>s?t&&t.id!==r?.id?i({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-ready",defaultMessage:"This entry is not at the required stage for publishing. ({stageName})"},{stageName:t?.name??""}):t&&t.id===r?.id?i({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.ready",defaultMessage:"This entry is at the required stage for publishing. ({stageName})"},{stageName:t?.name??""}):i({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.stage-not-required",defaultMessage:"No required stage for publication"}):i({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-enabled",defaultMessage:"This entry is not associated to any workflow."}),rs=({contentTypeHasReviewWorkflow:s,requiredStage:t,entryStage:r})=>{const{formatMessage:i}=E(),u=ns({contentTypeHasReviewWorkflow:s,requiredStage:t,entryStage:r});return e.jsxs(p,{direction:"column",gap:1,width:"100%",padding:5,children:[e.jsxs(p,{gap:2,width:"100%",children:[e.jsx(h,{fontWeight:"bold",children:i({id:"content-releases.pages.ReleaseDetails.entry-validation.review-stage",defaultMessage:"Review stage"})}),u]}),e.jsx(h,{textColor:"neutral600",children:is({contentTypeHasReviewWorkflow:s,requiredStage:t,entryStage:r,formatMessage:i})})]})},os=({schema:s,entry:t,status:r,action:i})=>{const{validate:u,isLoading:o}=xe({collectionType:s?.kind??"",model:s?.uid??""},{skip:!0}),d=o?null:u(t),M=d?Object.keys(d).length>0:!1,f=s?.hasReviewWorkflow??!1,m=s?.stageRequiredToPublish,D=t.strapi_stage;return o?null:e.jsxs(Z.Root,{children:[e.jsx(ts,{action:i,status:r,hasErrors:M,requiredStage:m,entryStage:D}),e.jsx(Z.Content,{children:e.jsxs(es,{direction:"column",children:[e.jsx(as,{hasErrors:M,errors:d,contentTypeUid:s?.uid,kind:s?.kind,documentId:t.documentId,locale:t.locale}),e.jsx(rs,{contentTypeHasReviewWorkflow:f,requiredStage:m,entryStage:D})]})})]})},ls=Re,he=s=>typeof s<"u"&&s.name!==void 0,ds=V(p)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:s})=>s.borderRadius};
  border-bottom-left-radius: ${({theme:s})=>s.borderRadius};
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,oe=({toggleEditReleaseModal:s,toggleWarningSubmit:t,children:r})=>{const{formatMessage:i,formatDate:u,formatTime:o}=E(),{releaseId:d}=ue(),{data:M,isLoading:f,error:m}=ee({id:d},{skip:!d}),[D,{isLoading:L}]=Be(),{toggleNotification:y}=K(),{formatAPIError:j}=X(),{allowedActions:$}=ge(te),{canUpdate:S,canDelete:z,canPublish:w}=$,B=ls(),{trackUsage:b}=Te(),n=M?.data,O=l=>async()=>{const g=await D({id:l});if("data"in g){y({type:"success",message:i({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:R,totalPublishedEntries:F,totalUnpublishedEntries:W}=g.data.meta;b("didPublishRelease",{totalEntries:R,totalPublishedEntries:F,totalUnpublishedEntries:W})}else G(g.error)?y({type:"danger",message:j(g.error)}):y({type:"danger",message:i({id:"notification.error",defaultMessage:"An error occurred"})})},x=()=>{B(Qe.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:d}]))},c=()=>n?.createdBy?n.createdBy.username?n.createdBy.username:n.createdBy.firstname?`${n.createdBy.firstname} ${n.createdBy.lastname||""}`.trim():n.createdBy.email:null;if(f)return e.jsx(U.Loading,{});if(he(m)&&"code"in m||!n)return e.jsx(se,{to:"..",state:{errors:[{code:m?.code}]}});const k=n.actions.meta.count||0,T=!!c(),v=n.scheduledAt&&n.timezone,N=i({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:k}),a=v?i({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:u(new Date(n.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:n.timezone}),time:o(new Date(n.scheduledAt),{timeZone:n.timezone,hourCycle:"h23"}),offset:Ce(n.timezone,new Date(n.scheduledAt))}):"";return e.jsx(H.Root,{children:e.jsxs(Ie,{"aria-busy":f,children:[e.jsx(H.Header,{title:n.name,subtitle:e.jsxs(p,{gap:2,lineHeight:6,children:[e.jsx(h,{textColor:"neutral600",variant:"epsilon",children:N+(v?` - ${a}`:"")}),e.jsx(pe,{...Ke(n.status),children:n.status})]}),navigationAction:e.jsx($e,{fallback:".."}),primaryAction:!n.releasedAt&&e.jsxs(p,{gap:2,children:[e.jsxs(cs,{label:e.jsx(Le,{}),variant:"tertiary",endIcon:null,paddingLeft:"7px",paddingRight:"7px","aria-label":i({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),popoverPlacement:"bottom-end",children:[e.jsx(ne.Item,{disabled:!S,onSelect:s,startIcon:e.jsx(Pe,{}),children:i({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})}),e.jsx(ne.Item,{disabled:!z,onSelect:t,variant:"danger",startIcon:e.jsx(Ee,{}),children:i({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})}),e.jsxs(ds,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:4,children:[e.jsx(h,{variant:"pi",fontWeight:"bold",children:i({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),e.jsxs(h,{variant:"pi",color:"neutral300",children:[e.jsx(Je,{timestamp:new Date(n.createdAt)}),i({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:c(),hasCreatedByUser:T})]})]})]}),e.jsx(q,{size:"S",variant:"tertiary",onClick:x,children:i({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),w?e.jsx(q,{size:"S",variant:"default",onClick:O(n.id.toString()),loading:L,disabled:n.actions.meta.count===0,children:i({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})}):null]})}),r]})})},cs=V(_e)`
  & > span {
    display: flex;
  }
`,us=["contentType","locale","action"],gs=["contentType","action"],le=s=>s==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:s==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},ps=({releaseId:s})=>{const{formatMessage:t}=E(),[{query:r},i]=ze(),{toggleNotification:u}=K(),{formatAPIError:o}=X(),{data:d,isLoading:M,error:f}=ee({id:s}),{allowedActions:{canUpdate:m}}=ge(te),D=Oe("ReleaseDetailsPage",a=>a.runHookWaterfall),{displayedHeaders:L,hasI18nEnabled:y}=D("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},name:"name"}],hasI18nEnabled:!1}),j=d?.data,$=r?.groupBy||"contentType",{isLoading:S,isFetching:z,isError:w,data:B,error:b}=ke({...r,releaseId:s}),[n]=Ne(),O=async(a,l,g)=>{const R=await n({params:{releaseId:s,actionId:l},body:{type:a.target.value},query:r,actionPath:g});"error"in R&&(G(R.error)?u({type:"danger",message:o(R.error)}):u({type:"danger",message:t({id:"notification.error",defaultMessage:"An error occurred"})}))};if(S||M)return e.jsx(U.Loading,{});const x=B?.data,c=B?.meta,k=c?.contentTypes||{};if(c?.components,he(f)||!j){const a=[];return f&&"code"in f&&a.push({code:f.code}),b&&"code"in b&&a.push({code:b.code}),e.jsx(se,{to:"..",state:{errors:a}})}if(w||!x)return e.jsx(U.Error,{});if(Object.keys(x).length===0)return e.jsx(H.Content,{children:e.jsx(Fe,{action:e.jsx(de,{tag:ce,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:t({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})}),icon:e.jsx(We,{width:"16rem"}),content:t({id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."})})});const T=t({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),v=[...L,{label:{id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"},name:"content-type"},{label:{id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"},name:"action"},...j.releasedAt?[]:[{label:{id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"},name:"status"}]],N=y?us:gs;return e.jsx(H.Content,{children:e.jsxs(p,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsx(p,{children:e.jsx(Ue,{placeholder:T,"aria-label":T,customizeContent:a=>t({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:a}),value:t(le($)),onChange:a=>i({groupBy:a}),children:N.map(a=>e.jsx(He,{value:a,children:t(le(a))},a))})}),Object.keys(x).map(a=>e.jsxs(p,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsx(p,{role:"separator","aria-label":a,children:e.jsx(pe,{children:a})}),e.jsx(C.Root,{rows:x[a].map(l=>({...l,id:Number(l.entry.id)})),headers:v,isLoading:S||z,children:e.jsxs(C.Content,{children:[e.jsx(C.Head,{children:v.map(({label:l,name:g})=>e.jsx(C.HeaderCell,{label:t(l),name:g},g))}),e.jsx(C.Loading,{}),e.jsx(C.Body,{children:x[a].map(({id:l,contentType:g,locale:R,type:F,entry:W,status:fe},me)=>e.jsxs(Ge,{children:[e.jsx(I,{width:"25%",maxWidth:"200px",children:e.jsx(h,{ellipsis:!0,children:`${g.mainFieldValue||W.id}`})}),y&&e.jsx(I,{width:"10%",children:e.jsx(h,{children:`${R?.name?R.name:"-"}`})}),e.jsx(I,{width:"10%",children:e.jsx(h,{children:g.displayName||""})}),e.jsx(I,{width:"20%",children:j.releasedAt?e.jsx(h,{children:t({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:F==="publish",b:_=>e.jsx(h,{fontWeight:"bold",children:_})})}):e.jsx(Ve,{selected:F,handleChange:_=>O(_,l,[a,me]),name:`release-action-${l}-type`,disabled:!m})}),!j.releasedAt&&e.jsxs(e.Fragment,{children:[e.jsx(I,{width:"20%",minWidth:"200px",children:e.jsx(os,{action:F,schema:k?.[g.uid],entry:W,status:fe})}),e.jsx(I,{children:e.jsx(p,{justifyContent:"flex-end",children:e.jsxs(Q.Root,{children:[e.jsx(Q.ReleaseActionEntryLinkItem,{contentTypeUid:g.uid,documentId:W.documentId,locale:R?.code}),e.jsx(Q.DeleteReleaseActionItem,{releaseId:j.id,actionId:l})]})})})]})]},l))})]})})]},`releases-group-${a}`)),c?.pagination?.pageCount&&c.pagination.pageCount>1&&e.jsxs(Y.Root,{...c?.pagination,defaultPageSize:c?.pagination?.pageSize,children:[e.jsx(Y.PageSize,{}),e.jsx(Y.Links,{})]})]})})},hs=()=>{const{formatMessage:s}=E(),{releaseId:t}=ue(),{toggleNotification:r}=K(),{formatAPIError:i}=X(),u=Me(),[o,d]=ae.useState(!1),[M,f]=ae.useState(!1),{isLoading:m,data:D,isSuccess:L}=ee({id:t},{skip:!t}),{data:y,isLoading:j}=De(),[$,{isLoading:S}]=we(),[z]=ve(),w=()=>{d(a=>!a)},B=()=>n?.timezone?n.timezone:y?.data.defaultTimezone?y.data.defaultTimezone:null,b=()=>f(a=>!a);if(m||j)return e.jsx(oe,{toggleEditReleaseModal:w,toggleWarningSubmit:b,children:e.jsx(U.Loading,{})});if(!t)return e.jsx(se,{to:".."});const n=L&&D?.data||null,O=n?.name||"",x=B(),c=n?.scheduledAt&&x?Ze(n.scheduledAt,x):null,k=c?re(c,"yyyy-MM-dd"):void 0,T=c?re(c,"HH:mm"):"",v=async a=>{const l=await $({id:t,name:a.name,scheduledAt:a.scheduledAt,timezone:a.timezone});"data"in l?(r({type:"success",message:s({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),w()):G(l.error)?r({type:"danger",message:i(l.error)}):r({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})},N=async()=>{const a=await z({id:t});"data"in a?u(".."):G(a.error)?r({type:"danger",message:i(a.error)}):r({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occurred"})})};return e.jsxs(oe,{toggleEditReleaseModal:w,toggleWarningSubmit:b,children:[e.jsx(ps,{releaseId:t}),e.jsx(qe,{open:o,handleClose:w,handleSubmit:v,isLoading:m||S,initialValues:{name:O||"",scheduledAt:c,date:k,time:T,isScheduled:!!c,timezone:x}}),e.jsx(Ae.Root,{open:M,onOpenChange:b,children:e.jsx(Se,{onConfirm:N,children:s({id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"})})})]})},Rs=()=>e.jsx(U.Protect,{permissions:te.main,children:e.jsxs(Ye,{children:[e.jsx(ie,{index:!0,element:e.jsx(Xe,{})}),e.jsx(ie,{path:":releaseId",element:e.jsx(hs,{})})]})});export{Rs as App};
