import {
  require_sortBy
} from "./chunk-QUZEQRQK.js";
import "./chunk-TNPN3H5O.js";
import {
  selectAdminPermissions
} from "./chunk-XCJJGVZC.js";
import "./chunk-7W4CK3MA.js";
import {
  SETTINGS_LINKS_CE,
  SubNav
} from "./chunk-EVNWODU4.js";
import {
  useIsMobile
} from "./chunk-TXPAHMSH.js";
import {
  useLicenseLimits
} from "./chunk-SZZ65EPC.js";
import {
  useEnterprise
} from "./chunk-PGK4XCH7.js";
import "./chunk-T2ARN7TZ.js";
import "./chunk-GRQHUTN5.js";
import {
  BackButton
} from "./chunk-Y7PW7LOS.js";
import "./chunk-U2S4VNVE.js";
import {
  Layouts
} from "./chunk-3VVEWNIU.js";
import {
  useAppInfo,
  useTracking
} from "./chunk-CHBEAGYH.js";
import "./chunk-6RQQFGOL.js";
import "./chunk-3GJUYW3U.js";
import {
  Page
} from "./chunk-W7EWQXCF.js";
import {
  useAuth,
  useStrapiApp
} from "./chunk-L5KTHKOW.js";
import "./chunk-4V4TECMW.js";
import "./chunk-CNQTL426.js";
import {
  RESPONSIVE_DEFAULT_SPACING
} from "./chunk-PWWLPW7X.js";
import "./chunk-O2YIDDWC.js";
import {
  useSelector
} from "./chunk-JMFYRDVQ.js";
import "./chunk-V3H6CYGR.js";
import "./chunk-ZC6UOKQ5.js";
import "./chunk-HM5YIFDI.js";
import "./chunk-QOUV5O5E.js";
import {
  Badge,
  Box,
  Divider,
  useIntl
} from "./chunk-WNDVG6TF.js";
import {
  Navigate,
  Outlet,
  useLocation,
  useMatch
} from "./chunk-RKN75MQZ.js";
import "./chunk-AWHRF5BE.js";
import {
  ForwardRef$1g
} from "./chunk-EXVE46AP.js";
import {
  require_jsx_runtime
} from "./chunk-LMPM4PM5.js";
import {
  dt
} from "./chunk-3LBZKDTB.js";
import {
  require_react
} from "./chunk-D3I3COXH.js";
import {
  __toESM
} from "./chunk-LK32TJAX.js";

// node_modules/@strapi/admin/dist/admin/admin/src/pages/Settings/Layout.mjs
var import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);

// node_modules/@strapi/admin/dist/admin/admin/src/hooks/useSettingsMenu.mjs
var React = __toESM(require_react(), 1);
var import_sortBy = __toESM(require_sortBy(), 1);
var formatLinks = (menu) => menu.map((menuSection) => {
  const formattedLinks = menuSection.links.map((link) => ({
    ...link,
    isDisplayed: false
  }));
  return {
    ...menuSection,
    links: formattedLinks
  };
});
var useSettingsMenu = () => {
  const [{ isLoading, menu }, setData] = React.useState({
    isLoading: true,
    menu: []
  });
  const checkUserHasPermission = useAuth("useSettingsMenu", (state) => state.checkUserHasPermissions);
  const shouldUpdateStrapi = useAppInfo("useSettingsMenu", (state) => state.shouldUpdateStrapi);
  const settings = useStrapiApp("useSettingsMenu", (state) => state.settings);
  const permissions = useSelector(selectAdminPermissions);
  const ceLinks = React.useMemo(() => SETTINGS_LINKS_CE(), []);
  const { admin: adminLinks, global: globalLinks } = useEnterprise(ceLinks, async () => (await import("./constants-S4V4WGSW.js")).SETTINGS_LINKS_EE(), {
    combine(ceLinks2, eeLinks) {
      return {
        admin: [
          ...eeLinks.admin,
          ...ceLinks2.admin
        ],
        global: [
          ...ceLinks2.global,
          ...eeLinks.global
        ]
      };
    },
    defaultValue: {
      admin: [],
      global: []
    }
  });
  const addPermissions = React.useCallback((link) => {
    var _a, _b;
    if (!link.id) {
      throw new Error("The settings menu item must have an id attribute.");
    }
    return {
      ...link,
      permissions: ((_b = (_a = permissions.settings) == null ? void 0 : _a[link.id]) == null ? void 0 : _b.main) ?? []
    };
  }, [
    permissions.settings
  ]);
  React.useEffect(() => {
    const getData = async () => {
      const buildMenuPermissions = (sections2) => Promise.all(sections2.reduce((acc, section, sectionIndex) => {
        const linksWithPermissions = section.links.map(async (link, linkIndex) => ({
          hasPermission: (await checkUserHasPermission(link.permissions)).length > 0,
          sectionIndex,
          linkIndex
        }));
        return [
          ...acc,
          ...linksWithPermissions
        ];
      }, []));
      const menuPermissions = await buildMenuPermissions(sections);
      setData((prev) => {
        return {
          ...prev,
          isLoading: false,
          menu: sections.map((section, sectionIndex) => ({
            ...section,
            links: section.links.map((link, linkIndex) => {
              const permission = menuPermissions.find((permission2) => permission2.sectionIndex === sectionIndex && permission2.linkIndex === linkIndex);
              return {
                ...link,
                isDisplayed: Boolean(permission == null ? void 0 : permission.hasPermission)
              };
            })
          }))
        };
      });
    };
    const { global, ...otherSections } = settings;
    const sections = formatLinks([
      {
        ...global,
        links: (0, import_sortBy.default)([
          ...global.links,
          ...globalLinks.map(addPermissions)
        ], (link) => link.id).map((link) => ({
          ...link,
          hasNotification: link.id === "000-application-infos" && shouldUpdateStrapi
        }))
      },
      {
        id: "permissions",
        intlLabel: {
          id: "Settings.permissions",
          defaultMessage: "Administration Panel"
        },
        links: adminLinks.map(addPermissions)
      },
      ...Object.values(otherSections)
    ]);
    getData();
  }, [
    adminLinks,
    globalLinks,
    settings,
    shouldUpdateStrapi,
    addPermissions,
    checkUserHasPermission
  ]);
  return {
    isLoading,
    menu: menu.map((menuItem) => ({
      ...menuItem,
      links: menuItem.links.filter((link) => link.isDisplayed)
    }))
  };
};

// node_modules/@strapi/admin/dist/admin/admin/src/pages/Settings/components/SettingsNav.mjs
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var StyledBadge = dt(Badge)`
  border-radius: 50%;
  padding: ${({ theme }) => theme.spaces[2]};
  height: 2rem;
`;
var SettingsNav = ({ isFullPage = false }) => {
  const { menu } = useSettingsMenu();
  const { formatMessage } = useIntl();
  const { trackUsage } = useTracking();
  const { pathname } = useLocation();
  const { license } = useLicenseLimits();
  const availableFeatureNames = license == null ? void 0 : license.features.map((feature) => feature.name);
  const linksIdsToLicenseFeaturesNames = {
    "content-releases": "cms-content-releases",
    "review-workflows": "review-workflows",
    sso: "sso",
    auditLogs: "audit-logs",
    "auditLogs-purchase-page": "audit-logs"
  };
  const filteredMenu = menu.filter((section) => !section.links.every((link) => link.isDisplayed === false));
  const sections = filteredMenu.map((section) => {
    return {
      ...section,
      title: section.intlLabel,
      links: section.links.map((link) => {
        return {
          ...link,
          id: link.id,
          title: link.intlLabel,
          name: link.id,
          to: link.to.startsWith("/") ? link.to : `/settings/${link.to}`
        };
      })
    };
  });
  const label = formatMessage({
    id: "global.settings",
    defaultMessage: "Settings"
  });
  const handleClickOnLink = (destination) => () => {
    trackUsage("willNavigate", {
      from: pathname,
      to: destination
    });
  };
  return (0, import_jsx_runtime.jsxs)(SubNav.Main, {
    "aria-label": label,
    children: [
      !isFullPage && (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
        children: [
          (0, import_jsx_runtime.jsx)(SubNav.Header, {
            label
          }),
          (0, import_jsx_runtime.jsx)(Divider, {})
        ]
      }),
      (0, import_jsx_runtime.jsxs)(SubNav.Content, {
        children: [
          isFullPage && (0, import_jsx_runtime.jsx)(SubNav.Header, {
            label
          }),
          (0, import_jsx_runtime.jsx)(SubNav.Sections, {
            children: sections.map((section) => (0, import_jsx_runtime.jsx)(SubNav.Section, {
              label: formatMessage(section.intlLabel),
              children: section.links.map((link) => {
                return (0, import_jsx_runtime.jsx)(SubNav.Link, {
                  to: link.to,
                  onClick: handleClickOnLink(link.to),
                  label: formatMessage(link.intlLabel),
                  endAction: (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
                    children: [
                      (link == null ? void 0 : link.licenseOnly) && (0, import_jsx_runtime.jsx)(ForwardRef$1g, {
                        fill: (availableFeatureNames || []).includes(linksIdsToLicenseFeaturesNames[link.id]) ? "primary600" : "neutral300",
                        width: "1.5rem",
                        height: "1.5rem"
                      }),
                      (link == null ? void 0 : link.hasNotification) && (0, import_jsx_runtime.jsx)(StyledBadge, {
                        "aria-label": "Notification",
                        backgroundColor: "primary600",
                        textColor: "neutral0",
                        children: "1"
                      })
                    ]
                  }),
                  children: formatMessage(link.intlLabel)
                }, link.id);
              })
            }, section.id))
          })
        ]
      })
    ]
  });
};

// node_modules/@strapi/admin/dist/admin/admin/src/pages/Settings/Layout.mjs
var Layout = () => {
  const match = useMatch("/settings/:settingId/*");
  const { formatMessage } = useIntl();
  const { isLoading } = useSettingsMenu();
  const isMobile = useIsMobile();
  if (isLoading) {
    return (0, import_jsx_runtime2.jsx)(Page.Loading, {});
  }
  if (!(match == null ? void 0 : match.params.settingId)) {
    if (!isMobile) {
      return (0, import_jsx_runtime2.jsx)(Navigate, {
        to: "application-infos"
      });
    }
    return (0, import_jsx_runtime2.jsxs)(import_jsx_runtime2.Fragment, {
      children: [
        (0, import_jsx_runtime2.jsx)(Page.Title, {
          children: formatMessage({
            id: "global.settings",
            defaultMessage: "Settings"
          })
        }),
        (0, import_jsx_runtime2.jsx)(SubNav.PageWrapper, {
          children: (0, import_jsx_runtime2.jsx)(SettingsNav, {
            isFullPage: true
          })
        })
      ]
    });
  }
  return (0, import_jsx_runtime2.jsxs)(Layouts.Root, {
    sideNav: (0, import_jsx_runtime2.jsx)(SettingsNav, {}),
    children: [
      (0, import_jsx_runtime2.jsx)(Page.Title, {
        children: formatMessage({
          id: "global.settings",
          defaultMessage: "Settings"
        })
      }),
      (0, import_jsx_runtime2.jsx)(Box, {
        display: {
          initial: "block",
          medium: "none"
        },
        paddingLeft: RESPONSIVE_DEFAULT_SPACING,
        paddingRight: RESPONSIVE_DEFAULT_SPACING,
        paddingTop: RESPONSIVE_DEFAULT_SPACING,
        children: (0, import_jsx_runtime2.jsx)(BackButton, {
          fallback: "/settings"
        })
      }),
      (0, import_jsx_runtime2.jsx)(Outlet, {})
    ]
  });
};
export {
  Layout
};
//# sourceMappingURL=Layout-FAXC7R2P.js.map
